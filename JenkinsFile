pipeline {
  /** ***************
   ** CONFIGURE AGENT
   ** **************/
  agent {
    node {
      // ** Set the node/agent our job should run on.
      label 'ecs_aws_instance'
    }
  }

  environment {
    REPO = ""
    TAG = ""
    BUILD = ""
    VERSION = ""
  }

  /**
   * ## PIPELINE
   */
  stages {
    
    /** ***************
     ** ## CONFIG ENV
     * Here we will load the properties file. This injects the Key=Pair
     * as environment variables.
     ** **************/
    stage("Config ENV") {
      steps {
        script {
        // ** Get the config file using the config ID and properties file
        def props = readProperties file: '.properties'

        sh "'echo ${props.REPO}' > REPO"
        sh "'echo ${props.TAG}' > TAG"
        sh "'echo ${props.VERSION}' > VERSION"
        sh "'echo ${props.RELEASE}' > RELEASE"
        }
      }
    }  // end stage  

    /** ***************
      ** ## Build game package
      ** **************/
    stage("Retrieve game package") {
      steps {
          sh "wget ${REPO}/download/${RELEASE}/${TAG}-${VERSION}.zip"
          sh "unzip ${TAG}-${VERSION}.zip"
      }
    }  

    /** ***************
      ** ## Deploy game package
      ** **************/
    stage("Deploy game package") {
      steps {
          sh "cp -r ${TAG}-${VERSION} /var/www/html"
      }
    } 
  } 
}